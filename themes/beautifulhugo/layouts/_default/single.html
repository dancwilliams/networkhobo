{{ define "main" }}
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        {{ .Content }}
      </article>

      <ul class="pager blog-pager">
        {{ if .PrevInSection }}
          <li class="previous">
            <a href="{{ .PrevInSection.Permalink }}" data-toggle="tooltip" data-placement="top" title="{{ .PrevInSection.Title }}">&larr; {{ i18n "previousPost" }}</a>
          </li>
        {{ end }}
        {{ if .NextInSection }}
          <li class="next">
            <a href="{{ .NextInSection.Permalink }}" data-toggle="tooltip" data-placement="top" title="{{ .NextInSection.Title }}">{{ i18n "nextPost" }} &rarr;</a>
          </li>
        {{ end }}
      </ul>

      {{ if (.Params.comments) | or (and (or (not (isset .Params "comments")) (eq .Params.comments nil)) (.Site.Params.comments)) }}
        {{ if .Site.DisqusShortname }}
          <div class="disqus-comments">
            {{ template "_internal/disqus.html" . }}
          </div>
        {{ end }}
        {{ if (.Site.Params.staticman_api) }}
          {{ partial "post-comments" . }}
        {{ end }}
      {{ end }}

      <script src='https://www.google.com/recaptcha/api.js' async defer></script>

      <br>

      
      {{ if and (.Site.Params.adsensePubID) (.Site.Params.adsenseAdID)  }}
        <field>
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
            <!-- NetworkHobo Test -->
          <ins class="adsbygoogle"
              style="display:block"
              data-ad-client="ca-{{ .Site.Params.adsensePubID }}"
              data-ad-slot="{{ .Site.Params.adsenseAdID }}"
              data-ad-format="auto"></ins>
          <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </field>
      {{ end }}
      <script>
      var commentContainerSelector = '#comments ul';
       
      if($(commentContainerSelector).length > 0 && "WebSocket" in window) {
        var ws = new WebSocket("ws://webmention.io:8080");
        ws.onopen = function(event) {
          // Send the current window URL to the server to register to receive notifications about this URL
          ws.send(window.location);
        };
        ws.onmessage = function(event) {
          var data = JSON.parse(event.data);
      
          if(data && data.type == "webmention") {
            // Create a simple <li> element with the information from the post.
            // Probably you will want to change the HTML generated here.
            var comment = $('<li/>').html('<a href="'+data.author.url+'"><img src="'+data.author.photo+'" width="48"></a> <a href="'+data.author.url+'">'+data.      author.name+'</a><br />'+data.content+'<br /><a href="'+data.url+'">'+data.published+'</a>');
      
            // Check if we've already added a comment for this ID, and update the existing one if so
            if($("#"+data.element_id).length == 0) {
              $(commentContainerSelector).append(comment);
            } else {
              $("#"+data.element_id+" li").html(comment);
            }
          }
        };
      }
      </script>
    </div>
  </div>
</div>
{{ end }}
